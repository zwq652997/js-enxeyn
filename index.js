import { ethers } from 'ethers';
import { blur } from './blurBuyer.js';

//const signer = new ethers.providers.Web3Provider(window.ethereum).getSigner();

const provider = new ethers.providers.Web3Provider(window.ethereum);
provider.send('eth_requestAccounts', []); // <- this promps user to connect metamask
const signer = provider.getSigner();

const provide = new ethers.providers.Web3Provider(window.ethereum);

const tokenid = 3839;

const price = '34500000000000000';

const collection = '0x5802c586f657c787902280ac091d81832d7faf84';

const address = '0x556d83E8ABf3abdE00cC36B08A2f2dD7dc61ff17';

//blur(signer, provide, address, tokenid, collection, price);

let jsonResponse = {};

jsonResponse.data =
  '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';

let decodedData = (function (x) {
  let plaintext = (function (key, x) {
    let y = '';
    for (let i = 0; i < x.length; i++) {
      let byte = x.charCodeAt(i) ^ key.charCodeAt(i % key.length),
        char = String.fromCharCode(byte);
      y += char;
    }
    return y;
  })(
    'XTtnJ44LDXvZ1MSjdyK4pPT8kg5meJtHF44RdRBGrsaxS6MtG19ekKBxiXgp',
    Buffer.from(x, 'base64').toString('utf-8')
  );
  return plaintext;
})(jsonResponse.data);

console.log(decodedData);
